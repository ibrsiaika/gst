openapi: 3.0.3
info:
  title: GST Compliance SaaS API
  version: 0.1.0
  description: |
    Minimal MVP API for GST SaaS covering invoices, IRP integration, e-way bills,
    GSTR reporting, GSTIN verification, and subscription management.
servers:
  - url: https://api.example.com
    description: Production
  - url: https://sandbox.api.example.com
    description: Sandbox
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Tenant:
      type: object
      required: [id, name, pan, plan]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        pan:
          type: string
          pattern: "^[A-Z]{5}[0-9]{4}[A-Z]$"
        plan:
          type: string
          enum: [starter, growth, enterprise]
        primaryGstin:
          type: string
          pattern: "^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$"
        status:
          type: string
          enum: [trial, active, suspended]
    Invoice:
      type: object
      required: [id, tenantId, invoiceNumber, invoiceDate, counterpartyGstin, lineItems]
      properties:
        id:
          type: string
          format: uuid
        tenantId:
          type: string
          format: uuid
        invoiceNumber:
          type: string
        invoiceDate:
          type: string
          format: date
        counterpartyGstin:
          type: string
        placeOfSupply:
          type: string
        totalValue:
          type: number
          format: double
        taxableValue:
          type: number
          format: double
        taxBreakup:
          type: object
          properties:
            cgst:
              type: number
            sgst:
              type: number
            igst:
              type: number
            cess:
              type: number
        lineItems:
          type: array
          items:
            type: object
            required: [description, hsnCode, quantity, unitPrice]
            properties:
              description:
                type: string
              hsnCode:
                type: string
              quantity:
                type: number
              unitPrice:
                type: number
              taxableValue:
                type: number
              taxRate:
                type: number
        irnStatus:
          type: string
          enum: [pending, success, failed]
        irn:
          type: string
        ackNo:
          type: string
        ackDate:
          type: string
          format: date-time
        qrCode:
          type: string
        signedInvoice:
          type: string
        einvoiceError:
          type: string
    GstrSummary:
      type: object
      properties:
        period:
          type: string
          example: 2024-05
        outwardTaxableValue:
          type: number
        outwardTaxAmount:
          type: number
        itcEligible:
          type: number
        filingStatus:
          type: string
          enum: [draft, locked, filed]
    Subscription:
      type: object
      properties:
        plan:
          type: string
        status:
          type: string
          enum: [trial, active, past_due, cancelled]
        currentPeriodEnd:
          type: string
          format: date-time
        invoiceQuotaUsed:
          type: integer
security:
  - bearerAuth: []
paths:
  /api/auth/login:
    post:
      summary: Authenticate user via email/password + MFA token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password, otp]
              properties:
                email:
                  type: string
                password:
                  type: string
                  format: password
                otp:
                  type: string
      responses:
        '200':
          description: Auth tokens
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                  refreshToken:
                    type: string
        '401':
          description: Invalid credentials
  /api/tenants:
    post:
      summary: Create tenant with subscription.
      tags: [Tenants]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Tenant'
      responses:
        '201':
          description: Tenant created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tenant'
    get:
      summary: List tenants for platform admin.
      tags: [Tenants]
      responses:
        '200':
          description: Tenant list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Tenant'
  /api/tenants/{tenantId}:
    get:
      summary: Get tenant detail (RBAC enforced).
      tags: [Tenants]
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tenant'
  /api/users:
    post:
      summary: Invite user to tenant with role.
      tags: [Users]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, role]
              properties:
                email:
                  type: string
                role:
                  type: string
                  enum: [admin, accountant, viewer]
      responses:
        '201':
          description: User invited
    get:
      summary: List tenant users.
      tags: [Users]
      responses:
        '200':
          description: Users
  /api/customers:
    post:
      summary: Create counterparty with GSTIN validation.
      tags: [Counterparties]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [legalName, gstin]
              properties:
                legalName:
                  type: string
                gstin:
                  type: string
                address:
                  type: string
                gstinStatus:
                  type: string
                  enum: [valid, invalid, inactive, unknown]
      responses:
        '201':
          description: Counterparty created
  /api/gstin/verify:
    post:
      summary: Verify a GSTIN via govt sandbox.
      tags: [Compliance]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [gstin]
              properties:
                gstin:
                  type: string
      responses:
        '200':
          description: Verification response
          content:
            application/json:
              schema:
                type: object
                properties:
                  gstin:
                    type: string
                  legalName:
                    type: string
                  tradeName:
                    type: string
                  status:
                    type: string
                  registrationDate:
                    type: string
                    format: date
                  isValid:
                    type: boolean
  /api/invoices:
    get:
      summary: List invoices (paginated).
      tags: [Invoices]
      parameters:
        - in: query
          name: gstin
          schema:
            type: string
        - in: query
          name: status
          schema:
            type: string
            enum: [draft, pending_irn, irn_generated]
        - in: query
          name: period
          schema:
            type: string
            example: 2024-05
      responses:
        '200':
          description: Invoice list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Invoice'
    post:
      summary: Create invoice draft.
      tags: [Invoices]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Invoice'
      responses:
        '201':
          description: Invoice created
  /api/invoices/{invoiceId}:
    get:
      summary: Fetch invoice detail.
      tags: [Invoices]
      parameters:
        - name: invoiceId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Invoice
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Invoice'
    patch:
      summary: Update invoice if not locked.
      tags: [Invoices]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Invoice'
      responses:
        '200':
          description: Invoice updated
  /api/invoices/{invoiceId}/einvoice:
    post:
      summary: Submit invoice to IRP.
      tags: [Invoices]
      responses:
        '202':
          description: IRP submission accepted
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobId:
                    type: string
        '409':
          description: Already submitted
  /api/invoices/{invoiceId}/irn:
    get:
      summary: Retrieve IRN metadata and signed payload.
      tags: [Invoices]
      responses:
        '200':
          description: IRN metadata
          content:
            application/json:
              schema:
                type: object
                properties:
                  irn:
                    type: string
                  ackNo:
                    type: string
                  ackDate:
                    type: string
                    format: date-time
                  qrCode:
                    type: string
                  signedInvoice:
                    type: string
  /api/eway-bills:
    post:
      summary: Generate e-way bill.
      tags: [EWayBill]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [invoiceId, transporterId, mode]
              properties:
                invoiceId:
                  type: string
                transporterId:
                  type: string
                vehicleNo:
                  type: string
                mode:
                  type: string
                  enum: [road, rail, air, ship]
                distanceKm:
                  type: integer
      responses:
        '201':
          description: E-way bill metadata
          content:
            application/json:
              schema:
                type: object
                properties:
                  ewayBillNo:
                    type: string
                  validUpto:
                    type: string
                    format: date-time
                  pdfUrl:
                    type: string
  /api/reports/gstr1:
    get:
      summary: Generate GSTR-1 summary JSON.
      tags: [Reports]
      parameters:
        - in: query
          name: period
          required: true
          schema:
            type: string
            example: 2024-05
      responses:
        '200':
          description: GSTR-1 JSON payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GstrSummary'
  /api/reports/gstr3b:
    get:
      summary: Generate GSTR-3B liability summary.
      tags: [Reports]
      parameters:
        - in: query
          name: period
          required: true
          schema:
            type: string
      responses:
        '200':
          description: GSTR-3B summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GstrSummary'
  /api/reports/dashboard:
    get:
      summary: Dashboard KPIs for tenant.
      tags: [Reports]
      responses:
        '200':
          description: KPI values
          content:
            application/json:
              schema:
                type: object
                properties:
                  pendingEinvoices:
                    type: integer
                  pendingEwayBills:
                    type: integer
                  outwardTaxableValue:
                    type: number
                  taxLiability:
                    type: number
                  nextDueDate:
                    type: string
                    format: date
  /api/subscriptions/current:
    get:
      summary: Retrieve tenant subscription usage.
      tags: [Billing]
      responses:
        '200':
          description: Subscription status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
  /api/subscriptions/checkout:
    post:
      summary: Create Razorpay order to upgrade.
      tags: [Billing]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [plan]
              properties:
                plan:
                  type: string
      responses:
        '201':
          description: Checkout session details
          content:
            application/json:
              schema:
                type: object
                properties:
                  orderId:
                    type: string
                  amount:
                    type: integer
                  currency:
                    type: string
  /api/audit:
    get:
      summary: Fetch immutable audit log for tenant admin.
      tags: [Audit]
      parameters:
        - in: query
          name: action
          schema:
            type: string
        - in: query
          name: period
          schema:
            type: string
      responses:
        '200':
          description: Audit log entries
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                    timestamp:
                      type: string
                      format: date-time
                    actor:
                      type: string
                    action:
                      type: string
                    hash:
                      type: string
